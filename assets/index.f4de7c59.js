var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,s=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&r(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&r(e,n,t[n]);return e},c=(e,o)=>t(e,n(o));import{r as l,o as d,c as p,a as u,V as m,T as v,C as h,b as f,F as x,d as y,w as g,E as w,e as b,M as E,f as z,Q as P,g as T,S as C,B as S,L,h as _,i as k,j as O,k as N,R,u as j,G as I,l as M,P as A,m as D,n as V,p as F,q as H,s as $,t as U,v as Y,x as G,y as B,z as X,A as Z,D as q,H as W,I as K,J as Q,K as J,N as ee,O as te,U as ne,W as oe,X as ae,Y as ie,Z as re,_ as se,$ as ce,a0 as le,a1 as de,a2 as pe,a3 as ue,a4 as me,a5 as ve,a6 as he}from"./vendor.3d86e3bf.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var fe=(e,t)=>{for(const[n,o]of t)e[n]=o;return e};var xe=fe({},[["render",function(e,t,n,o,a,i){const r=l("router-view");return d(),p("div",null,[u(r)])}]]);const ye="\n       vec4 permute(vec4 x){return mod(((x*34.)+1.)*x,289.);}\n        vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-.85373472095314*r;}\n\n        float snoise(vec3 v){\n            const vec2 C=vec2(1./6.,1./3.);\n            const vec4 D=vec4(0.,.5,1.,2.);\n            \n            // First corner\n            vec3 i=floor(v+dot(v,C.yyy));\n            vec3 x0=v-i+dot(i,C.xxx);\n            \n            // Other corners\n            vec3 g=step(x0.yzx,x0.xyz);\n            vec3 l=1.-g;\n            vec3 i1=min(g.xyz,l.zxy);\n            vec3 i2=max(g.xyz,l.zxy);\n            \n            //  x0 = x0 - 0. + 0.0 * C\n            vec3 x1=x0-i1+1.*C.xxx;\n            vec3 x2=x0-i2+2.*C.xxx;\n            vec3 x3=x0-1.+3.*C.xxx;\n            \n            // Permutations\n            i=mod(i,289.);\n            vec4 p=permute(permute(permute(\n                i.z+vec4(0.,i1.z,i2.z,1.))\n                +i.y+vec4(0.,i1.y,i2.y,1.))\n                +i.x+vec4(0.,i1.x,i2.x,1.));\n                \n                // Gradients\n                // ( N*N points uniformly over a square, mapped onto an octahedron.)\n                float n_=1./7.;// N=7\n                vec3 ns=n_*D.wyz-D.xzx;\n                \n                vec4 j=p-49.*floor(p*ns.z*ns.z);//  mod(p,N*N)\n                \n                vec4 x_=floor(j*ns.z);\n                vec4 y_=floor(j-7.*x_);// mod(j,N)\n                \n                vec4 x=x_*ns.x+ns.yyyy;\n                vec4 y=y_*ns.x+ns.yyyy;\n                vec4 h=1.-abs(x)-abs(y);\n                \n                vec4 b0=vec4(x.xy,y.xy);\n                vec4 b1=vec4(x.zw,y.zw);\n                \n                vec4 s0=floor(b0)*2.+1.;\n                vec4 s1=floor(b1)*2.+1.;\n                vec4 sh=-step(h,vec4(0.));\n                \n                vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;\n                vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;\n                \n                vec3 p0=vec3(a0.xy,h.x);\n                vec3 p1=vec3(a0.zw,h.y);\n                vec3 p2=vec3(a1.xy,h.z);\n                vec3 p3=vec3(a1.zw,h.w);\n                \n                //Normalise gradients\n                vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));\n                p0*=norm.x;\n                p1*=norm.y;\n                p2*=norm.z;\n                p3*=norm.w;\n                \n                // Mix final noise value\n                vec4 m=max(.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.);\n                m=m*m;\n                return 42.*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),\n                dot(p2,x2),dot(p3,x3)));\n            }\n            \n            vec3 snoiseVec3(vec3 x){\n                    return vec3(snoise(vec3(x)*2.-1.),\n                    snoise(vec3(x.y-19.1,x.z+33.4,x.x+47.2))*2.-1.,\n                    snoise(vec3(x.z+74.2,x.x-124.5,x.y+99.4)*2.-1.)\n                );\n            }\n        \n        vec3 curlNoise(vec3 p){\n            const float e=.1;\n            vec3 dx=vec3(e,0.,0.);\n            vec3 dy=vec3(0.,e,0.);\n            vec3 dz=vec3(0.,0.,e);\n            \n            vec3 p_x0=snoiseVec3(p-dx);\n            vec3 p_x1=snoiseVec3(p+dx);\n            vec3 p_y0=snoiseVec3(p-dy);\n            vec3 p_y1=snoiseVec3(p+dy);\n            vec3 p_z0=snoiseVec3(p-dz);\n            vec3 p_z1=snoiseVec3(p+dz);\n            \n            float x=p_y1.z-p_y0.z-p_z1.y+p_z0.y;\n            float y=p_z1.x-p_z0.x-p_x1.z+p_x0.z;\n            float z=p_x1.y-p_x0.y-p_y1.x+p_y0.x;\n            \n            const float divisor=1./(2.*e);\n            return normalize(vec3(x,y,z)*divisor);\n        }\n\n\n\n        uniform float uTime;\n        uniform float uProgress;\n        varying vec2 vUv;\n        varying vec3 vColor;\n        attribute float size;\n        attribute vec3 customColor;\n        void main(){\n            vColor = customColor;\n            vec3 noise=curlNoise(vec3(position.x*.02,position.y*.008,uTime*.05));\n            vec3 distortion=vec3(position.x*2.,position.y,1.)*noise*uProgress;\n            vec3 newPos=position+distortion;\n            vec4 modelPosition=modelMatrix*vec4(newPos,1.);\n            vec4 viewPosition=viewMatrix*modelPosition;\n            vec4 projectedPosition=projectionMatrix*viewPosition;\n            gl_Position=projectedPosition;\n            gl_PointSize=2.;\n          \n            vUv=uv;\n        }\n        ",ge="\n        uniform float uTime;\n        uniform vec2 uMouse;\n        uniform vec2 uResolution;\n        uniform sampler2D pointTexture;\n    \n        varying vec2 vUv;\n        uniform vec3 color;\n        varying vec3 vColor;  \n        void main(){\n            gl_FragColor = vec4( color * vColor, 1.0 );\n        }\n    ",we=Object.freeze({uTime:{value:0},uMouse:{value:new m(0,0)},uResolution:{value:new m(600,600)},uProgress:{value:0},uTexture:{value:(new v).load("/wp5723479.png")},color:{value:new h(16777215)}});var be=fe({name:"polygonExplosion",data(){return{curlNoise2DVertexShader:ye,curlNoiseFragmentShader:ge,curlNoiseUniforms:we,curl3DNoiseVertexShader:"\n       vec4 permute(vec4 x){return mod(((x*34.)+1.)*x,289.);}\n        vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-.85373472095314*r;}\n\n        float snoise(vec3 v){\n            const vec2 C=vec2(1./6.,1./3.);\n            const vec4 D=vec4(0.,.5,1.,2.);\n            \n            // First corner\n            vec3 i=floor(v+dot(v,C.yyy));\n            vec3 x0=v-i+dot(i,C.xxx);\n            \n            // Other corners\n            vec3 g=step(x0.yzx,x0.xyz);\n            vec3 l=1.-g;\n            vec3 i1=min(g.xyz,l.zxy);\n            vec3 i2=max(g.xyz,l.zxy);\n            \n            //  x0 = x0 - 0. + 0.0 * C\n            vec3 x1=x0-i1+1.*C.xxx;\n            vec3 x2=x0-i2+2.*C.xxx;\n            vec3 x3=x0-1.+3.*C.xxx;\n            \n            // Permutations\n            i=mod(i,289.);\n            vec4 p=permute(permute(permute(\n                i.z+vec4(0.,i1.z,i2.z,1.))\n                +i.y+vec4(0.,i1.y,i2.y,1.))\n                +i.x+vec4(0.,i1.x,i2.x,1.));\n                \n                // Gradients\n                // ( N*N points uniformly over a square, mapped onto an octahedron.)\n                float n_=1./7.;// N=7\n                vec3 ns=n_*D.wyz-D.xzx;\n                \n                vec4 j=p-49.*floor(p*ns.z*ns.z);//  mod(p,N*N)\n                \n                vec4 x_=floor(j*ns.z);\n                vec4 y_=floor(j-7.*x_);// mod(j,N)\n                \n                vec4 x=x_*ns.x+ns.yyyy;\n                vec4 y=y_*ns.x+ns.yyyy;\n                vec4 h=1.-abs(x)-abs(y);\n                \n                vec4 b0=vec4(x.xy,y.xy);\n                vec4 b1=vec4(x.zw,y.zw);\n                \n                vec4 s0=floor(b0)*2.+1.;\n                vec4 s1=floor(b1)*2.+1.;\n                vec4 sh=-step(h,vec4(0.));\n                \n                vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;\n                vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;\n                \n                vec3 p0=vec3(a0.xy,h.x);\n                vec3 p1=vec3(a0.zw,h.y);\n                vec3 p2=vec3(a1.xy,h.z);\n                vec3 p3=vec3(a1.zw,h.w);\n                \n                //Normalise gradients\n                vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));\n                p0*=norm.x;\n                p1*=norm.y;\n                p2*=norm.z;\n                p3*=norm.w;\n                \n                // Mix final noise value\n                vec4 m=max(.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.);\n                m=m*m;\n                return 42.*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),\n                dot(p2,x2),dot(p3,x3)));\n            }\n            \n            vec3 snoiseVec3(vec3 x){\n                    return vec3(snoise(vec3(x)*2.-1.),\n                    snoise(vec3(x.y-19.1,x.z+33.4,x.x+47.2))*2.-1.,\n                    snoise(vec3(x.z+74.2,x.x-124.5,x.y+99.4)*2.-1.)\n                );\n            }\n        \n        vec3 curlNoise(vec3 p){\n            const float e=.1;\n            vec3 dx=vec3(e,0.,0.);\n            vec3 dy=vec3(0.,e,0.);\n            vec3 dz=vec3(0.,0.,e);\n            \n            vec3 p_x0=snoiseVec3(p-dx);\n            vec3 p_x1=snoiseVec3(p+dx);\n            vec3 p_y0=snoiseVec3(p-dy);\n            vec3 p_y1=snoiseVec3(p+dy);\n            vec3 p_z0=snoiseVec3(p-dz);\n            vec3 p_z1=snoiseVec3(p+dz);\n            \n            float x=p_y1.z-p_y0.z-p_z1.y+p_z0.y;\n            float y=p_z1.x-p_z0.x-p_x1.z+p_x0.z;\n            float z=p_x1.y-p_x0.y-p_y1.x+p_y0.x;\n            \n            const float divisor=1./(2.*e);\n            return normalize(vec3(x,y,z)*divisor);\n        }\n\n\n\n        uniform float uTime;\n        uniform float uProgress;\n        varying vec2 vUv;\n        varying vec3 vColor;\n        attribute float size;\n        attribute vec3 customColor;\n        void main(){\n            vColor = customColor;\n            vec3 noise=curlNoise(vec3(position.x*.02,position.y*.008,position.z*.05));\n            vec3 distortion=vec3(position.x,position.y,position.z)*noise*uProgress;\n            vec3 newPos=position+distortion;\n            vec4 modelPosition=modelMatrix*vec4(newPos,1.);\n            vec4 viewPosition=viewMatrix*modelPosition;\n            vec4 projectedPosition=projectionMatrix*viewPosition;\n            gl_Position=projectedPosition;\n            gl_PointSize=2.;\n          \n            vUv=uv;\n        }\n        ",config:{noiseValueTransitionScale:this.$d3.scaleLinear([0,1],[0,3]),clock:new f}}},mounted(){const e=this.$refs.renderer,t=this.$refs.box.mesh;t.position.set(0,0,-200);const n=t.geometry.getAttribute("position"),o=[],a=new h;for(let i=0,r=n.count;i<r;i++)a.setHSL(.01+i/r*.1,1,.5),a.toArray(o,3*i);t.geometry.setAttribute("customColor",new x(o,3)),e.onBeforeRender((()=>{t.rotation.x+=.01})),setTimeout((()=>{this.dispatchActivateExplosionEffect(t)}),2e3)},methods:{async dispatchActivateExplosionEffect(e){let t=e;await this.$d3.transition("activate-explosion").duration(3e3).tween("render",(()=>e=>{t.material.uniforms.uProgress.value=this.config.noiseValueTransitionScale(e)})).transition("shrink-explosion").tween("render",(()=>e=>{t.material.uniforms.uProgress.value=this.config.noiseValueTransitionScale(1-e)})).end()}}},[["render",function(e,t,n,o,a,i){const r=l("Camera"),s=l("PointLight"),c=l("BoxGeometry"),p=l("ShaderMaterial"),m=l("Points"),v=l("Scene"),h=l("Renderer");return d(),y(h,{ref:"renderer",antialias:"",resize:"window","orbit-ctrl":""},{default:g((()=>[u(r,{position:{z:10}}),u(v,null,{default:g((()=>[u(s,{position:{y:50,z:50,x:25}}),u(m,{onClick:i.dispatchActivateExplosionEffect,ref:"box",rotation:{y:Math.PI/4,z:Math.PI/4}},{default:g((()=>[u(c,{width:100,height:100,depth:100,widthSegments:100,heightSegments:100,depthSegments:100}),u(p,{props:{vertexShader:a.curl3DNoiseVertexShader,uniforms:a.curlNoiseUniforms,fragmentShader:a.curlNoiseFragmentShader}},null,8,["props"])])),_:1},8,["onClick","rotation"])])),_:1})])),_:1},512)}]]);var Ee=fe({name:"planeExplosion",data(){return{particleExplodeFragmentShader:"\nuniform float uTime;\nuniform vec2 uMouse;\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\n\nvarying vec2 vUv;\n\nvoid main(){\n    vec4 color=texture2D(uTexture,vUv);\n    if(color.r<.1&&color.g<.1&&color.b<.1){\n        discard;\n    }\n    gl_FragColor=color;\n}\n",particleExplodeVertexShader:"\nvec4 permute(vec4 x){return mod(((x*34.)+1.)*x,289.);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159-.85373472095314*r;}\n\nfloat snoise(vec3 v){\n    const vec2 C=vec2(1./6.,1./3.);\n    const vec4 D=vec4(0.,.5,1.,2.);\n    \n    // First corner\n    vec3 i=floor(v+dot(v,C.yyy));\n    vec3 x0=v-i+dot(i,C.xxx);\n    \n    // Other corners\n    vec3 g=step(x0.yzx,x0.xyz);\n    vec3 l=1.-g;\n    vec3 i1=min(g.xyz,l.zxy);\n    vec3 i2=max(g.xyz,l.zxy);\n    \n    //  x0 = x0 - 0. + 0.0 * C\n    vec3 x1=x0-i1+1.*C.xxx;\n    vec3 x2=x0-i2+2.*C.xxx;\n    vec3 x3=x0-1.+3.*C.xxx;\n    \n    // Permutations\n    i=mod(i,289.);\n    vec4 p=permute(permute(permute(\n                i.z+vec4(0.,i1.z,i2.z,1.))\n                +i.y+vec4(0.,i1.y,i2.y,1.))\n                +i.x+vec4(0.,i1.x,i2.x,1.));\n                \n                // Gradients\n                // ( N*N points uniformly over a square, mapped onto an octahedron.)\n                float n_=1./7.;// N=7\n                vec3 ns=n_*D.wyz-D.xzx;\n                \n                vec4 j=p-49.*floor(p*ns.z*ns.z);//  mod(p,N*N)\n                \n                vec4 x_=floor(j*ns.z);\n                vec4 y_=floor(j-7.*x_);// mod(j,N)\n                \n                vec4 x=x_*ns.x+ns.yyyy;\n                vec4 y=y_*ns.x+ns.yyyy;\n                vec4 h=1.-abs(x)-abs(y);\n                \n                vec4 b0=vec4(x.xy,y.xy);\n                vec4 b1=vec4(x.zw,y.zw);\n                \n                vec4 s0=floor(b0)*2.+1.;\n                vec4 s1=floor(b1)*2.+1.;\n                vec4 sh=-step(h,vec4(0.));\n                \n                vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;\n                vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;\n                \n                vec3 p0=vec3(a0.xy,h.x);\n                vec3 p1=vec3(a0.zw,h.y);\n                vec3 p2=vec3(a1.xy,h.z);\n                vec3 p3=vec3(a1.zw,h.w);\n                \n                //Normalise gradients\n                vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));\n                p0*=norm.x;\n                p1*=norm.y;\n                p2*=norm.z;\n                p3*=norm.w;\n                \n                // Mix final noise value\n                vec4 m=max(.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.);\n                m=m*m;\n                return 42.*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),\n                dot(p2,x2),dot(p3,x3)));\n            }\n            \n            vec3 snoiseVec3(vec3 x){\n                return vec3(snoise(vec3(x)*2.-1.),\n                snoise(vec3(x.y-19.1,x.z+33.4,x.x+47.2))*2.-1.,\n                snoise(vec3(x.z+74.2,x.x-124.5,x.y+99.4)*2.-1.)\n            );\n        }\n        \n        vec3 curlNoise(vec3 p){\n            const float e=.1;\n            vec3 dx=vec3(e,0.,0.);\n            vec3 dy=vec3(0.,e,0.);\n            vec3 dz=vec3(0.,0.,e);\n            \n            vec3 p_x0=snoiseVec3(p-dx);\n            vec3 p_x1=snoiseVec3(p+dx);\n            vec3 p_y0=snoiseVec3(p-dy);\n            vec3 p_y1=snoiseVec3(p+dy);\n            vec3 p_z0=snoiseVec3(p-dz);\n            vec3 p_z1=snoiseVec3(p+dz);\n            \n            float x=p_y1.z-p_y0.z-p_z1.y+p_z0.y;\n            float y=p_z1.x-p_z0.x-p_x1.z+p_x0.z;\n            float z=p_x1.y-p_x0.y-p_y1.x+p_y0.x;\n            \n            const float divisor=1./(2.*e);\n            return normalize(vec3(x,y,z)*divisor);\n        }\n        \n        uniform float uTime;\n        uniform float uProgress;\n        varying vec2 vUv;\n        \n        void main(){\n            vec3 noise=curlNoise(vec3(position.x*.02,position.y*.008,uTime*.05));\n            vec3 distortion=vec3(position.x*2.,position.y,1.)*noise*uProgress;\n            vec3 newPos=position+distortion;\n            vec4 modelPosition=modelMatrix*vec4(newPos,1.);\n            vec4 viewPosition=viewMatrix*modelPosition;\n            vec4 projectedPosition=projectionMatrix*viewPosition;\n            gl_Position=projectedPosition;\n            gl_PointSize=2.;\n            \n            vUv=uv;\n        }\n",curlNoiseUniforms:we,curlNoise2DVertexShader:ye,curlNoiseFragmentShader:ge,config:{noiseValueTransitionScale:this.$d3.scaleLinear([0,1],[0,3]),clock:new f}}},mounted(){this.$refs.renderer;const e=this.$refs.box.mesh;e.position.set(0,0,-1e3);const t=e.geometry.getAttribute("position"),n=[],o=new h;for(let a=0,i=t.count;a<i;a++)o.setHSL(.01+a/i*.1,1,.5),o.toArray(n,3*a);e.geometry.setAttribute("customColor",new x(n,3)),setTimeout((()=>{this.dispatchActivateExplosionEffect(e)}),2e3)},methods:{async dispatchActivateExplosionEffect(e){let t=e;await this.$d3.transition("activate-explosion").duration(3e3).tween("render",(()=>e=>{t.material.uniforms.uProgress.value=this.config.noiseValueTransitionScale(e),t.material.uniforms.uTime.value=this.config.clock.getElapsedTime()})).transition("shrink-explosion").tween("render",(()=>e=>{t.material.uniforms.uProgress.value=this.config.noiseValueTransitionScale(1-e),t.material.uniforms.uTime.value=this.config.clock.getElapsedTime()})).end()}}},[["render",function(e,t,n,o,a,i){const r=l("Camera"),s=l("PointLight"),c=l("PlaneGeometry"),m=l("ShaderMaterial"),v=l("Points"),h=l("Scene"),f=l("Renderer");return d(),p("div",null,[u(f,{ref:"renderer",antialias:"",resize:"window","orbit-ctrl":""},{default:g((()=>[u(r,{position:{z:10}}),u(h,null,{default:g((()=>[u(s,{position:{y:50,z:50,x:25}}),u(v,{onClick:i.dispatchActivateExplosionEffect,ref:"box"},{default:g((()=>[u(c,{width:1770,height:1e3,widthSegments:50,heightSegments:50}),u(m,{props:{vertexShader:a.particleExplodeVertexShader,uniforms:a.curlNoiseUniforms,fragmentShader:a.particleExplodeFragmentShader}},null,8,["props"])])),_:1},8,["onClick"])])),_:1})])),_:1},512)])}]]);var ze=fe({name:"data-handler-mixin",data(){return{rawData:{filteredSongList:[],filteredSongObj:{},fullRankingList:[],fullSongList:[]},dataAdapterConfig:{modelConverting:{timeline2ZoomScale:this.$d3.scaleLinear([new Date("1968-01-01"),new Date("1970-01-01")],[2e3,0]),valence2YCoordScale:this.$d3.scaleLinear([0,1],[-15,15]),dance2XCoordScale:this.$d3.scaleLinear([0,1],[-30,30]),relationPoint2CenteringDistanceScale:this.$d3.scaleLinear([1,20],[0,5])}}}},methods:{_rankingGraphPositionSimulation(e){return e.forEach((e=>{let[t,n]=e;this.$d3.forceSimulation(t).force("link",this.$d3.forceLink(n)).force("charge",this.$d3.forceManyBody().strength((e=>e.customStrength||2.3))).force("x",this.$d3.forceX()).force("y",this.$d3.forceY()).velocityDecay(.7).tick(3).stop(),t.forEach((e=>{e.position.set(e.x,e.y,e.position.z)}))})),e},_centeringPositionSimulation(e){return this.$d3.forceSimulation(e).force("charge",this.$d3.forceManyBody().strength(-10)).force("x",this.$d3.forceX()).force("y",this.$d3.forceY()).velocityDecay(.5).tick(10).stop(),e.forEach((e=>{e.position.set(e.x,e.y,e.position.z)})),e},async _initRawData(){let[e,t]=await Promise.all([this.$d3.json("./musicData/50-jahre-filtered.json"),this.$d3.json("./musicData/50-jahre.json")]),n=null==e?void 0:e.songs;Object.keys(null==e?void 0:e.songs).forEach((e=>{n[e].rankList=[]}));let o=null==t?void 0:t.entries;this.lodash.assign(this.rawData,{fullRankingList:o,filteredSongObj:n})},_aggregateSongModal(){let{filteredSongObj:e,fullRankingList:t}=this.rawData;t.forEach((t=>{let n=null==t?void 0:t.song;if(e[n]){let o=e[n];o.rankList.push(t),o.highestRank=o.highestRank?Math.min(t.rank,o.highestRank):t.rank,o.releaseDate=t.date}}));let n=[];const{timeline2ZoomScale:o,valence2YCoordScale:a,dance2XCoordScale:i,relationPoint2CenteringDistanceScale:r}=this.dataAdapterConfig.modelConverting;Object.keys(e).forEach(((t,r)=>{let c=e[t],l=new this.THREE.Vector3(i(c.dance),a(c.valence),o(new Date(c.releaseDate)));const d={position:l,x:l.x,y:l.y,index:r};n.push(s(s({},this.lodash.cloneDeep(e[t])),d))}));let l=this._centeringPositionSimulation(n);const d=this.$d3.scaleLinear([1,20],[-2.5,-4]);let p=l.map(((e,t)=>{let{rankList:n,position:a}=e,i=Math.atan2(e.valence,e.dance),l=n.map(((e,n)=>{let l=r(e.rank),p=Math.random()*Math.PI/2-Math.PI/4+i,[u,m]=[l*Math.cos(p),l*Math.sin(p)],v=new this.THREE.Vector3(a.x+u,a.y+m,o(new Date(e.date)));return c(s({},e),{id:`graph-${t}-${n}`,position:v,x:a.x,y:a.y,customStrength:d(e.rank)})})),p=[];return l.forEach(((e,t)=>{t>=1&&p.push({source:t-1,target:t})})),[[...l,c(s({},e),{fx:e.x,fy:e.y})],p]}));return[l,this._rankingGraphPositionSimulation(p)]},async initFilteredRelationMapData(){return await this._initRawData(),this._aggregateSongModal()}}},[["render",function(e,t,n,o,a,i){return null}]]);const Pe=function(e,t){var n,o,a,i,r,s;void 0===t&&console.warn('THREE.customOrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.customOrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new b,this.minDistance=0,this.maxDistance=2e3,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:E.ROTATE,MIDDLE:E.DOLLY,RIGHT:E.PAN},this.touches={ONE:z.ROTATE,TWO:z.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",ae),this._domElementKeyEvents=e},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(l),c.update(),v=u.NONE},this.update=(n=new b,o=(new P).setFromUnitVectors(e.up,new b(0,1,0)),a=o.clone().invert(),i=new b,r=new P,s=2*Math.PI,function(){T.update();var e=c.object.position;n.copy(e).sub(c.target),n.applyQuaternion(o),f.setFromVector3(n),c.autoRotate&&v===u.NONE&&M(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(f.theta+=x.theta*c.dampingFactor,f.phi+=x.phi*c.dampingFactor):(f.theta+=x.theta,f.phi+=x.phi);var t=c.minAzimuthAngle,d=c.maxAzimuthAngle;return isFinite(t)&&isFinite(d)&&(t<-Math.PI?t+=s:t>Math.PI&&(t-=s),d<-Math.PI?d+=s:d>Math.PI&&(d-=s),f.theta=t<=d?Math.max(t,Math.min(d,f.theta)):f.theta>(t+d)/2?Math.max(t,f.theta):Math.min(d,f.theta)),f.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,f.phi)),f.makeSafe(),f.radius=c.maxDistance*c.scale,f.radius=Math.max(c.minDistance,Math.min(c.maxDistance,f.radius)),!0===c.enableDamping?c.target.addScaledVector(y,c.dampingFactor):c.target.add(y),n.setFromSpherical(f),n.applyQuaternion(a),e.copy(c.target).add(n),c.object.updateProjectionMatrix(),!0===c.enableDamping?(x.theta*=1-c.dampingFactor,x.phi*=1-c.dampingFactor,y.multiplyScalar(1-c.dampingFactor)):(x.set(0,0,0),y.set(0,0,0)),!!(g||i.distanceToSquared(c.object.position)>h||8*(1-r.dot(c.object.quaternion))>h)&&(c.dispatchEvent(l),i.copy(c.object.position),r.copy(c.object.quaternion),g=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",ce),c.domElement.removeEventListener("pointerdown",J),c.domElement.removeEventListener("wheel",oe),c.domElement.removeEventListener("touchstart",ie),c.domElement.removeEventListener("touchend",se),c.domElement.removeEventListener("touchmove",re),c.domElement.ownerDocument.removeEventListener("pointermove",ee),c.domElement.ownerDocument.removeEventListener("pointerup",te),null!==c._domElementKeyEvents&&c._domElementKeyEvents.removeEventListener("keydown",ae)},this.scale=1;var c=this,l={type:"change"},d={type:"start"},p={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=u.NONE,h=1e-6,f=new C;new C;var x=new C,y=new b,g=!1,w=new m,S=new m,L=new m,_=new m,k=new m,O=new m,N=new m,R=new m,j=new m;function I(){return Math.pow(.95,c.zoomSpeed)}function M(e){x.theta-=e}function A(e){x.phi-=e}var D,V=(D=new b,function(e,t){D.setFromMatrixColumn(t,0),D.multiplyScalar(-e),y.add(D)}),F=function(){var e=new b;return function(t,n){!0===c.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(c.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),H=function(){var e=new b;return function(t,n){var o=c.domElement;if(c.object.isPerspectiveCamera){var a=c.object.position;e.copy(a).sub(c.target);var i=e.length();i*=Math.tan(c.object.fov/2*Math.PI/180),V(2*t*i/o.clientHeight,c.object.matrix),F(2*n*i/o.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(V(t*(c.object.right-c.object.left)/c.object.zoom/o.clientWidth,c.object.matrix),F(n*(c.object.top-c.object.bottom)/c.object.zoom/o.clientHeight,c.object.matrix)):(console.warn("WARNING: customOrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function $(e){c.object.isPerspectiveCamera?U(c.scale/e):c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: customOrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function U(e){if(e>1||e<0)return;const t={scale:c.scale};return new T.Tween(t).to({scale:e},800).easing(T.Easing.Cubic.Out).onUpdate((()=>{c.scale=t.scale})).start()}function Y(e){c.object.isPerspectiveCamera?U(c.scale*e):c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: customOrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function G(e){w.set(e.clientX,e.clientY)}function B(e){_.set(e.clientX,e.clientY)}function X(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}}function Z(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,n)}}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);N.set(0,o)}function W(e){if(1==e.touches.length)S.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(t,n)}L.subVectors(S,w).multiplyScalar(c.rotateSpeed);var o=c.domElement;M(2*Math.PI*L.x/o.clientHeight),A(2*Math.PI*L.y/o.clientHeight),w.copy(S)}function K(e){if(1==e.touches.length)k.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);k.set(t,n)}O.subVectors(k,_).multiplyScalar(c.panSpeed),H(O.x,O.y),_.copy(k)}function Q(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);R.set(0,o),j.set(0,Math.pow(R.y/N.y,c.zoomSpeed)),$(j.y),N.copy(R)}function J(e){if(!1!==c.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case E.DOLLY:if(!1===c.enableZoom)return;!function(e){N.set(e.clientX,e.clientY)}(e),v=u.DOLLY;break;case E.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;B(e),v=u.PAN}else{if(!1===c.enableRotate)return;G(e),v=u.ROTATE}break;case E.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;G(e),v=u.ROTATE}else{if(!1===c.enablePan)return;B(e),v=u.PAN}break;default:v=u.NONE}v!==u.NONE&&(c.domElement.ownerDocument.addEventListener("pointermove",ee),c.domElement.ownerDocument.addEventListener("pointerup",te),c.dispatchEvent(d))}(e)}}function ee(e){if(!1!==c.enabled)switch(e.pointerType){case"mouse":ne(e);case"pen":ne(e)}}function te(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(c.domElement.ownerDocument.removeEventListener("pointermove",ee),c.domElement.ownerDocument.removeEventListener("pointerup",te),!1===c.enabled)return;c.dispatchEvent(p),v=u.NONE}()}}function ne(e){if(!1!==c.enabled)switch(e.preventDefault(),v){case u.ROTATE:if(!1===c.enableRotate)return;!function(e){S.set(e.clientX,e.clientY),L.subVectors(S,w).multiplyScalar(c.rotateSpeed);var t=c.domElement;M(2*Math.PI*L.x/t.clientHeight),A(2*Math.PI*L.y/t.clientHeight),w.copy(S),c.update()}(e);break;case u.DOLLY:if(!1===c.enableZoom)return;!function(e){R.set(e.clientX,e.clientY),j.subVectors(R,N),j.y>0?$(I()):j.y<0&&Y(I()),N.copy(R),c.update()}(e);break;case u.PAN:if(!1===c.enablePan)return;!function(e){k.set(e.clientX,e.clientY),O.subVectors(k,_).multiplyScalar(c.panSpeed),H(O.x,O.y),_.copy(k),c.update()}(e)}}function oe(e){!1===c.enabled||!1===c.enableZoom||v!==u.NONE&&v!==u.ROTATE||(e.preventDefault(),c.dispatchEvent(d),function(e){e.deltaY<0?Y(I()):e.deltaY>0&&$(I()),c.update()}(e),c.dispatchEvent(p))}function ae(e){!1!==c.enabled&&!1!==c.enablePan&&function(e){var t=!1;switch(e.code){case c.keys.UP:H(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:H(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:H(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT:H(-c.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),c.update())}(e)}function ie(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(c.touches.ONE){case z.ROTATE:if(!1===c.enableRotate)return;X(e),v=u.TOUCH_ROTATE;break;case z.PAN:if(!1===c.enablePan)return;Z(e),v=u.TOUCH_PAN;break;default:v=u.NONE}break;case 2:switch(c.touches.TWO){case z.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&q(e),c.enablePan&&Z(e)}(e),v=u.TOUCH_DOLLY_PAN;break;case z.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&q(e),c.enableRotate&&X(e)}(e),v=u.TOUCH_DOLLY_ROTATE;break;default:v=u.NONE}break;default:v=u.NONE}v!==u.NONE&&c.dispatchEvent(d)}}function re(e){if(!1!==c.enabled)switch(e.preventDefault(),v){case u.TOUCH_ROTATE:if(!1===c.enableRotate)return;W(e),c.update();break;case u.TOUCH_PAN:if(!1===c.enablePan)return;K(e),c.update();break;case u.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&Q(e),c.enablePan&&K(e)}(e),c.update();break;case u.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&Q(e),c.enableRotate&&W(e)}(e),c.update();break;default:v=u.NONE}}function se(e){!1!==c.enabled&&(c.dispatchEvent(p),v=u.NONE)}function ce(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener("contextmenu",ce),c.domElement.addEventListener("pointerdown",J),c.domElement.addEventListener("wheel",oe),c.domElement.addEventListener("touchstart",ie),c.domElement.addEventListener("touchend",se),c.domElement.addEventListener("touchmove",re),this.update()};(Pe.prototype=Object.create(w.prototype)).constructor=Pe;var Te=function(e,t){Pe.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=E.PAN,this.mouseButtons.RIGHT=E.ROTATE,this.touches.ONE=z.PAN,this.touches.TWO=z.DOLLY_ROTATE};(Te.prototype=Object.create(w.prototype)).constructor=Te;async function Ce(e,t){const n=Object.freeze({HOVER:1,ACTIVATE:2,INITIAL:4,UPDATE:8});await(async()=>new Promise((e=>{(new N).load("fonts/gentilis_regular.typeface.json",(t=>{e()}))})))();return{createTextSelectorInstance:(o,a,i,r,s=!1)=>{const c=new I;let l=M("");c.position.set(o,a,0);let d={x:o,y:a,w:i,h:r},p=((e,t="click to input something")=>{const n=document.createElement("canvas");let o=n.getContext("2d");return n.width=10*e.w,n.height=10*e.h,o.fillStyle="black",o.textBaseline="top",o.font="16px Avenir,Helvetica",o.fillText(t,8,n.height/2-8),n})(d),u=new O(p),m={geometry:new A(i,r),material:new D({transparent:!0,opacity:.3,map:u,side:V})},v=new F(m.geometry,m.material);s&&v.rotateY(Math.PI);let h=M(n.INITIAL);const f=H((()=>Object.freeze({[n.HOVER]:"green",[n.ACTIVATE]:"red",[n.INITIAL]:"white",[n.UPDATE]:"black"})[h.value]||"white"));return $((()=>{((e,t,n,o,a)=>{let i=e.getContext("2d");i&&(i.clearRect(0,0,10*o.w,10*o.h),i.fillStyle="black",i.textBaseline="top",i.font="16px Avenir,Helvetica",i.textAlign="center",i.textBaseline="middle",i.fillText(n,e.width/2,e.height/2),i.lineWidth=5,i.strokeStyle=a,i.strokeRect(0,0,e.width,e.height),t.needsUpdate=!0)})(p,u,l.value||"click to input something",d,f.value)})),t.set(c,{focus:()=>{h.value=n.HOVER},clear:()=>{h.value=n.INITIAL},activate:()=>(h.value=n.ACTIVATE,l.value),update:e=>{l.value=e}}),c.add(v),e.add(c),v}}}const Se={class:"container"},Le={class:"control-block"},_e={key:0},ke={key:1,class:"control-block"};function Oe(){const e=q([0,15],[5,12]),t=q([0,15],[1,2]),n=(e=[],t=5)=>(new b).setFromSphericalCoords(t,W.degToRad(90-e[1]),W.degToRad(180+e[0])),o=(t,n)=>{let o=e(t.distanceTo(n)),[a,i]=[(new C).setFromVector3(t),(new C).setFromVector3(n)],r=Math.abs(a.theta-i.theta)>Math.PI,s=i.theta;return r&&(s=s<0?2*Math.PI+s:-2*Math.PI+s),(new b).setFromSphericalCoords(o,(a.phi+i.phi)/2,(a.theta+s)/2)},a=e=>{let n=[];return e.forEach(((e,o)=>{const[,a]=e;let i=a[0],r=a[a.length-1];n.push({impactPosition:i,impactMaxRadius:t(i.distanceTo(r)),impactRatio:0},{impactPosition:r,impactMaxRadius:t(i.distanceTo(r)),impactRatio:0})})),[n.map(((e,t)=>new T.Tween(e).to({impactRatio:1},W.randInt(1e3,1500)).onComplete((()=>{e.impactRatio=0})))),n]},i=(e,t=[],n=[])=>t.map(((t,o)=>{const[a,i,r]=t;return i[0].equals(i[i.length-1])?((e,t,n,o)=>{let a=new I,i=(new C).setFromVector3(n[0]),r=i.clone();r.radius=4.3;let s=i.clone();s.radius=.5;let c=i.clone();c.radius=.6;let l=(new b).setFromSpherical(c),d=(new b).setFromSpherical(s);const p=new K;p.setPoints([new b(0,0,0),d]);const u=new Q({color:"blue",lineWidth:.03,useAlphaMap:0}),m=(new S).setFromPoints([l]),v=new J({size:.2}),h=new F(p,u);h.userData=t;const f=new ee(m,v);a.add(h,f),a.position.set((new b).setFromSpherical(r)),e.add(a);const x=new T.Tween((new b).setFromSpherical(i)).delay(5e3).to((new b).setFromSpherical(r),3e3).onStart((()=>{h.userData.enableDisplayCommit=!1})).onUpdate((e=>{a.position.set(e.x,e.y,e.z)})),y=new T.Tween((new b).setFromSpherical(r)).delay(2e3*Math.random()).onStart((()=>{o&&o.start()})).to((new b).setFromSpherical(i),3e3).onUpdate((e=>{a.position.set(e.x,e.y,e.z)})).onComplete((()=>{h.userData.enableDisplayCommit=!0}));return y.chain(x),y})(e,r,i,n[2*o]):((e,t,n,o,a)=>{e.add(t);let i={counter:0},r=new T.Tween({counter:0}).delay(5e3).easing(T.Easing.Cubic.InOut).to({counter:n.length},2500).onStart((()=>{t.userData.enableDisplayCommit=!1})).onUpdate((e=>{let o=n.slice(e.counter-1,n.length);t.geometry.setPoints(o)})),s=new T.Tween(i).delay(2e3*Math.random()).onStart((()=>{o&&o.start()})).to({counter:n.length},2500).onUpdate((()=>{let e=n.slice(0,i.counter);t.geometry.setPoints(e)})).onComplete((()=>{t.userData.enableDisplayCommit=!0,a.start()}));return s.chain(r),s})(e,a,i,n[2*o],n[2*o+1])}));return{generateCommitTweenList:async(e,t=M([]))=>{let r=await(async()=>(await te("./gitIndex/github-index-0929.json")).map((e=>{let{gm:t,gop:a}=e,i=[a.lon,a.lat],r=[t.lon,t.lat],[s,c]=[n(i),n(r)];return[s,o(s,c),c,e]})).sort(((e,t)=>{let[n,o]=[e[0],t[1]];return Math.abs(n.x)>Math.abs(o.x)})).map((e=>{let[t,n,o,a]=e;const i=new ne(t,n,o).getPoints(100),r=new K;r.setPoints([]);const s=new Q({color:"lightGreen",lineWidth:.05,useAlphaMap:0}),c=new F(r,s);return c.userData=a,c.raycast=oe,[c,i,a]})))(),[s,c]=a(r),l=i(e,r,s);return t.value=c,l}}}function Ne(){const e=new Image,[t,n]=[360,181],o=[],a=M([]);let{generateCommitTweenList:i}=Oe();return{initCompositeGlobePlane:async r=>{await new Promise((t=>{e.src="./gitIndex/globalMap.png",e.onload=()=>{t()}}));let s=document.createElement("canvas");s.width=t,s.height=n;let c=s.getContext("2d"),l=new ae;c.drawImage(e,0,0,t,n),c.fillStyle="white";let d=c.getImageData(0,0,t,n).data;for(let e=0;e<n;e++)for(let n=0;n<t;n++){if(d[4*(t*e+n)+3]>128){let t=(new b).setFromSphericalCoords(5,W.degToRad(e),W.degToRad(n)),a=t.toArray();l.lookAt(t),l.updateMatrix();let i=.03,r=new A(i,i);r.applyMatrix4(l.matrix),r.translate.apply(r,a);let s=new Array(4).fill(a).flat();r.setAttribute("center",new x(s,3)),o.push(r)}}await(async e=>{let t=0,n=await i(e,a);re((()=>{t=t>=n.length?t%n.length+3:t+3,n.slice(t-3,t).forEach((e=>e.start()))}),1e3)})(r);let p=ie.mergeBufferGeometries(o,!0),u=new D({color:6697898,onBeforeCompile:e=>{let t=a.value.length;e.uniforms.impacts={value:a.value},e.vertexShader=`\n      \tstruct impact {\n          vec3 impactPosition;\n          float impactMaxRadius;\n          float impactRatio;\n        };\n      \tuniform impact impacts[${a.value.length}];\n\n        attribute vec3 center;\n        attribute float scale;\n\n        varying float vFinalStep;\n\n        ${e.vertexShader}\n      `.replace("#include <begin_vertex>",`#include <begin_vertex>\n        float finalStep = 0.0;\n        for (int i = 0; i < ${t};i++){\n\n          float dist = distance(center, impacts[i].impactPosition);\n          float curRadius = impacts[i].impactMaxRadius * impacts[i].impactRatio;\n          float sstep = smoothstep(0., curRadius, dist) - smoothstep(curRadius - ( 0.25 * impacts[i].impactRatio ), curRadius, dist);\n          sstep *= 1. - impacts[i].impactRatio;\n          finalStep += sstep;\n\n        }\n        finalStep = clamp(finalStep, 0., 1.);\n        vFinalStep = finalStep;\n        transformed = (position - center) * mix(1., scale * 1.25, finalStep) + center; // scale on wave\n        transformed += normal * finalStep * 0.125; // lift on wave\n        `),e.fragmentShader=`\n        varying float vFinalStep;\n        ${e.fragmentShader}\n        `.replace("vec4 diffuseColor = vec4( diffuse, opacity );","\n        if (length(vUv - 0.5) > 0.5) discard; // make points circular\n        vec3 grad = mix(vec3(1, 0.75, 1), vec3(0, 1, 1), clamp(length(vUv - 0.5) / 0.5, 0., 1.)); // circular gradient\n        vec3 col = mix(diffuse, grad, vFinalStep); // color on wave\n        vec4 diffuseColor = vec4( col , opacity ); \n        ")}});u.defines={USE_UV:""};const m=new F(p,u);return r.add(m),m}}}function Re(){let e=(()=>{const e=document.createElement("canvas");return e.width=670,e.height=150,e})(),t=new O(e),n=new k(new _({map:t,depthTest:!1,depthWrite:!1,fog:!1}));n.scale.set(6.7,1.5,1),n.renderOrder=-1;return{toggleCommitInfoPlane:(o=!0,a="",i=new b)=>{n.visible=o,n.position.set(i.x,i.y,6),a&&o&&((n={})=>{let o=e.getContext("2d");o&&(o.clearRect(0,0,670,150),o.fillStyle="rgba(22,22,22,0.5)",o.fillRect(0,0,670,150),o.fillStyle="white",o.font="24px Avenir,Helvetica",o.fillText(`#${n.pr}\t${n.nwo}`,20,40),o.fillText(`${n.l}\t* Opened in ${n.uol}`,20,80),o.fillText(`merged at ${n.ma} in ${n.uml}`,20,120),o.lineWidth=5,t.needsUpdate=!0,console.dir("canvas updated"))})(a)},initCommitInfoPlane:e=>{e.add(n)}}}var je=[{path:"/polygonExplosion",component:be},{path:"/planeExplosion",component:Ee},{path:"/cameraTester",component:fe({name:"cameraTester",mixins:[ze],data(){return{config:{viewPortSpinRatio:this.$d3.scaleLinear([-1,1],[0,1]),rank2spriteScaleRatio:this.$d3.scaleLinear([0,1,20],[2,1.5,.6]),backgroundLoader:"black",fontLoader:null,orbitControlConfig:{enableZoom:!0,zoomSpeed:3,enablePan:!1,enableRotate:!1,minDistance:0,maxDistance:2e3,enableDamping:!0,dampingFactor:.25}},control:{orbitControlInstance:null,rayCasterInstance:null},interact:{mousePosition:new b,cameraPosition:new b(0,0,2e3),cameraLookatPosition:new b(0,0,0),zoomPos:2e3,zoom:500,clickEffect:{activatedNodeInstanceList:null,activatedLineTweenList:null}},adaptedSongList:[]}},computed:{dynamicMousePosition(){}},methods:{initOrbitControl(){let{renderer:e}=this.$refs;const t=new Pe(e.camera,e.renderer.domElement);return this.config.orbitControlConfig instanceof Object&&Object.entries(this.config.orbitControlConfig).forEach((([e,n])=>{t[e]=n})),e.onBeforeRender((()=>{t.update()})),t},renderYearText(){let e=[1500,500];const t=new this.THREE.MeshBasicMaterial({transparent:!0,opacity:.1}),n=this.$refs.sceneInstance;[1968,1969].forEach(((o,a)=>{const i=new this.THREE.TextGeometry(o+"",{size:40,height:.1,font:this.config.fontLoader});i.computeBoundingBox();const r=-.5*(i.boundingBox.max.x-i.boundingBox.min.x),s=-.5*(i.boundingBox.max.y-i.boundingBox.min.y);let c=new this.THREE.Mesh(i,t);c.renderOrder=10,c.position.set(r,s,e[a]),n.add(c)}))},renderRelationGraph(e){const t=this.$refs.sceneInstance;e.forEach((e=>{const n=new this.THREE.Group;let[o,a]=e;o.pop(),this.renderLinkList(a,n),this.renderNodeList(o,"white",n),t.add(n)}))},renderLinkList(e,t){const n=new this.THREE.LineBasicMaterial({opacity:.1,transparent:!0,depthWrite:!1});e.forEach((e=>{const o=[e.source.position,e.target.position],a=(new S).setFromPoints(o);let i=new L(a,n);this.$refs.renderer.three.addIntersectObject(i),t.add(i)}))},renderNodeList(e,t="yellow",n){const{sceneInstance:o,renderer:a}=this.$refs,i=new _({map:(new v).load("./musicData/circle.png"),color:t}),r=new this.THREE.Sprite(i);e.forEach((e=>{let t=r.clone(),i=e.rank||0;t.scale.setScalar(this.config.rank2spriteScaleRatio(i)),t.userData=this.lodash.cloneDeep(e),n?(n.add(t),a.three.addIntersectObject(t)):o.add(t),t.position.copy(e.position)}))},renderNodeCardList(e){const t=this.$refs.sceneInstance;new this.THREE.SpriteMaterial,e.forEach((e=>{let n=this.drawCardCanvas(e),o=new _({map:n,color:"#ff649f"}),a=new k(o);a.position.copy(e.position),t.add(a),a.scale.set(21,12,1)}))},generateNodeCanvasTexture(e){const t=document.createElement("canvas");let n=t.getContext("2d");return t.width=100,t.height=100,n.beginPath(),n.arc(50,50,50,0,2*Math.PI,!1),n.fillStyle="white",n.fill(),n.fillStyle="black",n.font="bold 56px Avenir,Helvetica",n.fillText(null==e?void 0:e.rank,32.5,65),new O(t)},drawCardCanvas(e){const t=document.createElement("canvas");let n=t.getContext("2d");return t.width=700,t.height=400,n.fillStyle="white",n.textBaseline="top",n.font=" bold 56px Avenir,Helvetica",n.fillText(e.artist,0,0),n.font="80px Avenir,Helvetica",n.fillText(e.title,0,80),n.beginPath(),n.arc(50,220,50,0,2*Math.PI,!1),n.fillStyle="white",n.fill(),n.fillStyle="black",n.font="bold 56px Avenir,Helvetica",n.fillText(e.highestRank,32.5,195),n.font="56px Avenir,Helvetica",n.fillStyle="white",n.fillText(this.dayjs(e.releaseDate).format("LL"),120,195),new O(t)},initLoader(){this.config.fontLoader=(new N).load("fonts/helvetiker_bold.typeface.json");let e=new Promise((e=>{(new N).load("fonts/helvetiker_regular.typeface.json",(t=>{this.config.fontLoader=t,e()}))})),t=new Promise((e=>{(new v).load("./backgroundTexture.png",(t=>{t.wrapT=R,this.config.backgroundLoader=t,e()}))}));return Promise.all([e,t])},adjustCameraLookAtPosition(){let{renderer:e}=this.$refs,{x:t,y:n}=e.three.pointer.position;this.interact.cameraLookatPosition.x=t,this.interact.cameraLookatPosition.y=-n},activateGraphLinkEffect:e=>e.map((e=>{const t={opacity:.1};return new T.Tween(t).to({opacity:1},400).onUpdate((()=>{e.material.opacity=t.opacity})).repeat(1/0).yoyo(!0).start()})),activateGraphNodeEffect(e){const t=this.$refs.sceneInstance;let n=[];return e.map((e=>{let{userData:t}=e,o=this.generateNodeCanvasTexture(t),a=new _({map:o}),i=new k(a);n.push(i),i.position.copy(t.position);const r={x:.5,y:.5,z:.5},s=new T.Tween(r).easing(T.Easing.Cubic.Out).to({x:3,y:3},400).onUpdate((()=>{i.scale.set(r.x,r.y,r.z)})),c=new T.Tween(r).easing(T.Easing.Cubic.Out).to({x:2,y:2},400).onUpdate((()=>{i.scale.set(r.x,r.y,r.z)}));return s.chain(c),{tweenExpand:s,instance:i}})).forEach((({tweenExpand:e,instance:n},o)=>{t.add(n),e.delay(150*o).start()})),n},_checkNodeInactivatedNodeInstanceList(e){let t=!1,{activatedNodeInstanceList:n}=this.interact.clickEffect;return n&&e&&(t=n.find((t=>e===t))),t},deactivateClickEffects(){let{activatedNodeInstanceList:e,activatedLineTweenList:t}=this.interact.clickEffect;e&&t&&(e.forEach((e=>{e.removeFromParent()})),t.forEach((e=>{T.remove(e)})),this.lodash.assign(this.interact.clickEffect,{activatedNodeInstanceList:null,activatedLineTweenList:null}))},dispatchRelationExpansion(){var e;let{pointer:t}=this.$refs.renderer.three;if(this.control.rayCasterInstance){let n=this.control.rayCasterInstance.intersect(t.positionN,t.intersectObjects,!1);if(n.length>0){let t=n[0].object,o=(null==t?void 0:t.parent)instanceof this.THREE.Group;if(!this._checkNodeInactivatedNodeInstanceList(t)&&(this.deactivateClickEffects(),o)){let n=[],o=[];(null==(e=null==t?void 0:t.parent)?void 0:e.children).forEach((e=>{e instanceof L?o.push(e):e instanceof k&&n.push(e)}));let a=this.activateGraphLinkEffect(o),i=this.activateGraphNodeEffect(n);this.lodash.assign(this.interact.clickEffect,{activatedNodeInstanceList:i,activatedLineTweenList:a})}}}}},async mounted(){var e;await this.initLoader(),this.control.orbitControlInstance=this.initOrbitControl(),this.control.rayCasterInstance=new j({camera:null==(e=this.$refs.camera)?void 0:e.camera});let[t,n]=await this.initFilteredRelationMapData();this.renderNodeCardList(t),this.renderRelationGraph(n),this.renderYearText(),window.addEventListener("mousemove",this.adjustCameraLookAtPosition),window.addEventListener("click",this.dispatchRelationExpansion)}},[["render",function(e,t,n,o,a,i){const r=l("Camera"),s=l("Scene"),c=l("Renderer");return d(),y(c,{ref:"renderer",antialias:"",resize:"window",pointer:""},{default:g((()=>[u(r,{far:550,fov:50,aspect:1,ref:"camera",position:a.interact.cameraPosition,lookAt:a.interact.cameraLookatPosition},null,8,["position","lookAt"]),u(s,{ref:"sceneInstance",background:a.config.backgroundLoader},null,8,["background"])])),_:1},512)}]])},{path:"/cbill",component:fe({setup(){const e=U(new b(0,0,-10)),t=M(null),n=M(null),o=M(null),a=M(""),i=M(null),r=U({x:0,y:0,z:0}),s=U({x:0,y:0,z:10}),c=H((()=>"edit"===i.value)),l=H((()=>"display"===i.value));let d=null,p=null,u=null;const{plane:m,createPlaneInstance:h,instanceMap:f}=function(){const e=M(null),t=[],n=new WeakMap,o=[[-13.4,13.4,21,2.2],[-13.4,11.4,21,2.2],[-13.4,9.4,21,2.2],[-13.4,7.4,21,2.2],[21.4,13.4,21,2.2],[21.4,11.4,21,2.2],[21.4,9.4,21,2.2],[21.4,7.4,21,2.2],[-7,5.8,58,2.2,!0],[-7,7.8,58,2.2,!0],[-7,9.8,58,2.2,!0],[-7,11.8,58,2.2,!0],[-7,.7,58,2.2,!0],[-7,-1.3,58,2.2,!0],[-7,-3.3,58,2.2,!0],[-7,-5.3,58,2.2,!0],[-7,-10.5,58,2.2,!0],[-7,-12.5,58,2.2,!0],[-7,-14.5,58,2.2,!0],[-7,-16.5,58,2.2,!0]],a=e=>new Promise(((t,n)=>{(new v).load(e,(e=>{t(e)}),void 0,(e=>{n(e)}))}));return{plane:e,createPlaneInstance:async e=>{let i=new A(108,80),[r,s]=await Promise.all([a("./cbill/bill-back.png"),a("./cbill/bill-front.png")]),c=new D({map:r,side:V,depthWrite:!1}),l=new D({map:s,side:V,depthWrite:!1}),d=new F(i.clone(),l),p=new F(i.clone(),c);d.position.set(0,0,0),p.position.set(0,0,0),p.geometry.rotateY(Math.PI),e.add(d),e.add(p);const u=await Ce(e,n);return o.forEach((e=>{t.push(u.createTextSelectorInstance.apply(u,e))})),t},instanceMap:n}}();Y(a,(e=>{u&&u.update(e)})),Y(i,((e,t)=>{if(e!==t)switch(e){case"display":x();break;case"edit":y()}}));const x=async()=>{},y=()=>{r.y=r.y%(2*Math.PI);return[new T.Tween(r).to({x:0,y:0,z:0},500).start(),new T.Tween(n.value.three.camera.position).to({x:0,y:0,z:10},500).start()]},g=()=>{var e;p&&c.value&&(u=p,null==(e=null==o?void 0:o.value)||e.focus(),a.value=u.activate())},w=()=>{var e;let{pointer:t}=null==(e=n.value)?void 0:e.three;if(d&&c.value){let e=d.intersect(t.positionN,t.intersectObjects,!1);if(e.length>0){let t=e[0].object;t!==p&&(p&&p.clear(),u&&(u.clear(),u=null),p=f.get(t.parent),null==p||p.focus())}else p&&(p.clear(),p=null)}};return G((()=>{h(t.value).then((e=>{var t,o;i.value="display",e.forEach((e=>{n.value.three.addIntersectObject(e)})),null==(o=null==(t=null==n?void 0:n.value)?void 0:t.three)||o.cameraCtrl.saveState(),n.value.onBeforeRender((()=>{T.update(),l.value&&(r.y+=.005)}))})),d=new j({camera:n.value.camera}),window.addEventListener("mousemove",w),window.addEventListener("click",g)})),{plane:m,renderer:n,createPlaneInstance:h,cbillGroup:t,rotateCntl:r,userInput:a,hiddenInput:o,toggleMode:(e,t)=>{e.preventDefault(),i.value=t},orbitTarget:e,typeControl:i,cameraPosCntl:s}}},[["render",function(e,t,n,o,a,i){const r=l("Camera"),s=l("AmbientLight"),c=l("Group"),m=l("Scene"),v=l("Renderer");return d(),p("div",Se,[B("div",Le,[X(B("input",{ref:"hiddenInput","onUpdate:modelValue":t[0]||(t[0]=e=>o.userInput=e),class:"hidden-input"},null,512),[[Z,o.userInput]]),o.typeControl?(d(),p("div",ke,[B("a",{href:"#",onClick:t[1]||(t[1]=e=>o.toggleMode(e,"edit"))},"edit mode"),B("a",{href:"#",onClick:t[2]||(t[2]=e=>o.toggleMode(e,"display"))},"display mode")])):(d(),p("div",_e," loading texture image data... "))]),u(v,{ref:"renderer","orbit-ctrl":{target:o.orbitTarget},antialias:"",pointer:"",resize:"window"},{default:g((()=>[u(r,{ref:"camera",lookAt:o.orbitTarget,position:o.cameraPosCntl},null,8,["lookAt","position"]),u(m,{ref:"scene"},{default:g((()=>[u(s),u(c,{ref:"cbillGroup",position:o.orbitTarget,rotation:o.rotateCntl,scale:{x:.25,y:.25,z:.25}},null,8,["position","rotation","scale"])])),_:1},512)])),_:1},8,["orbit-ctrl"])])}],["__scopeId","data-v-6da58860"]])},{path:"/gitIndex",component:fe({name:"gitIndex",setup(){let e=null,t=M(.001);const{initCompositeGlobePlane:n}=Ne(),{initCommitInfoPlane:o,toggleCommitInfoPlane:a}=Re(),i=M(null),r=M(null),s=M(null),c=U({x:0,y:Math.PI/3,z:0}),l=()=>{var n,o;let{pointer:i}=null==(n=s.value)?void 0:n.three,r=e.intersect(i.positionN,i.intersectObjects,!1);if(r.length>0){let e=r[0].object;(null==(o=null==e?void 0:e.userData)?void 0:o.enableDisplayCommit)&&(t.value=0,a(!0,null==e?void 0:e.userData,i.positionV3))}else t.value=.001,a(!1)};return G((async()=>{var a,d,p,u;o(i.value);let m=null==(d=null==(a=r.value)?void 0:a.o3d)?void 0:d.children[0],v=await n(r.value);null==(u=null==(p=r.value)?void 0:p.o3d)||u.children.forEach((e=>{e.children.length>0||s.value.three.addIntersectObject(e)})),s.value.three.removeIntersectObject(m),s.value.three.removeIntersectObject(v),s.value.onBeforeRender((()=>{T.update(),c.y+=t.value})),e=new j({camera:s.value.camera}),window.addEventListener("mousemove",l)})),{scene:i,renderer:s,parentGroup:r,rotateCntl:c}}},[["render",function(e,t,n,o,a,i){const r=l("Camera"),s=l("PointLight"),c=l("SphereGeometry"),m=l("PhongMaterial"),v=l("Mesh"),h=l("Group"),f=l("Scene"),x=l("RenderPass"),y=l("FXAAPass"),w=l("UnrealBloomPass"),b=l("EffectComposer"),E=l("Renderer");return d(),p("div",null,[u(E,{ref:"renderer","orbit-ctrl":{enableRotate:!1},pointer:"",resize:"window"},{default:g((()=>[u(r,{far:20,fov:50,position:{x:0,y:5,z:12}}),u(f,{ref:"scene"},{default:g((()=>[u(s,{ref:"light1",intensity:.3,position:{x:-35,y:35,z:-10},color:"#0E09DC"},null,8,["intensity"]),u(s,{ref:"light2",intensity:.3,position:{x:-25,y:25,z:-10},color:"#1CD1E1"},null,8,["intensity"]),u(s,{ref:"light3",intensity:.3,position:{x:-15,y:15,z:-10},color:"#18C02C"},null,8,["intensity"]),u(s,{ref:"light4",intensity:.3,position:{x:-5,y:5,z:-10},color:"#ee3bcf"},null,8,["intensity"]),u(s,{ref:"light5",intensity:1,position:{x:-9,y:11,z:-15},color:"white"},null,512),u(h,{ref:"parentGroup",rotation:o.rotateCntl},{default:g((()=>[u(v,null,{default:g((()=>[u(c,{heightSegments:25,radius:5,widthSegments:25}),u(m,{props:{emissive:"#043a8a",emissiveIntensity:.3},color:"white"},null,8,["props"])])),_:1})])),_:1},8,["rotation"])])),_:1},512),u(b,null,{default:g((()=>[u(x),u(y),u(w,{strength:.8})])),_:1})])),_:1},512)])}]])}];se.extend(ce);const Ie=le({history:de(),routes:je}),Me=pe(xe);Me.use(Ie),Me.use(ue),Me.mount("#app"),Me.config.globalProperties.THREE=me,Me.config.globalProperties.$d3=ve,Me.config.globalProperties.dayjs=se,Me.config.globalProperties.lodash=he;
